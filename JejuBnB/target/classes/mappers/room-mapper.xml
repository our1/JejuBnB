<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
"-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="roomMapper">
	<resultMap type="Room" id="resultRoom">
		<id property="room_no" column="room_no" />
		<result property="user_id" column="user_id" />	
		<result property="room_name" column="room_name" />	
		<result property="room_content" column="room_content" />	
		<result property="room_address" column="room_address" />
		<result property="room_roadaddress" column="room_readaddress" />
		<result property="st_num_people" column="st_num_people" />		
		<result property="max_people" column="max_people" />	
		<result property="checkin_time" column="checkin_time" />	
		<result property="checkout_time" column="checkout_time" />	
		<result property="bed" column="bed" />	
		<result property="bedroom" column="bedroom" />	
		<result property="bathroom" column="bathroom"/>	
		<result property="amenity" column="amenity" />	
		<result property="facility" column="facility" />	
		<result property="build_type" column="build_type" />	
		<result property="rule" column="rule" />	
		<result property="pass_or_not" column="pass_or_not" />	
		<result property="plus_charge" column="plus_charge" />	
		<result property="room_original_file" column="room_original_file" />	
		<result property="room_rename_file" column="room_rename_file" />	
		<result property="score_avg" column="score_avg" />	
	</resultMap>
	
	<resultMap type="Room" id="resultList">
		<id property="room_no" column="room_no" />
		<result property="user_id" column="user_id" />	
		<result property="room_name" column="room_name" />	
		<result property="room_content" column="room_content" />	
		<result property="room_address" column="room_address" />	
		<result property="room_roadaddress" column="room_readaddress" />
		<result property="st_num_people" column="st_num_people" />	
		<result property="max_people" column="max_people" />	
		<result property="checkin_time" column="checkin_time" />	
		<result property="checkout_time" column="checkout_time" />	
		<result property="bed" column="bed" />	
		<result property="bedroom" column="bedroom" />	
		<result property="bathroom" column="bathroom"/>	
		<result property="amenity" column="amenity" />	
		<result property="facility" column="facility" />	
		<result property="build_type" column="build_type" />	
		<result property="rule" column="rule" />	
		<result property="pass_or_not" column="pass_or_not" />	
		<result property="plus_charge" column="plus_charge" />	
		<result property="room_thumbnail_file" column="room_thumbnail_file" />	
		<result property="room_rename_file" column="room_rename_file" />	
		<result property="score_avg" column="score_avg" />	
	</resultMap>
	
	
	<select id="selectList" parameterType="com.jeju.JejuBnB.room.model.vo.PageCount" resultMap="resultList">
	<![CDATA[
		select * from(select rownum rnum, room_no, user_id, room_name, room_content, room_address, room_roadaddress, max_people, checkin_time, checkout_time, bed, bedroom, 
		bathroom, amenity, facility, build_type, rule, pass_or_not, st_num_people, plus_charge, room_thumbnail_file, room_rename_file, score_avg from room order by room_name)
		where rnum >= #{startRow} and rnum <= #{endRow}
		]]>
	</select>
	
	<select id="selectBList" parameterType="com.jeju.JejuBnB.room.model.vo.PageCount" resultMap="resultList">
	<![CDATA[
		select * from(select rownum rnum, room_no, user_id, room_name, room_content, room_address, room_roadaddress, max_people, checkin_time, checkout_time, bed, bedroom, 
		bathroom, amenity, facility, build_type, rule, pass_or_not, st_num_people, plus_charge, room_thumbnail_file, room_rename_file, score_avg from room order by room_name)
		where rnum >= #{startRow} and rnum <= #{endRow}
		]]>
	</select>
	
	<select id="selectUserRoom" parameterType="string" resultMap="resultList">
		select * from room where user_id = #{uid}
	</select>
	
	<select id="selectRoom" parameterType="int" resultMap="resultRoom">
		select * from room where room_no = #{room_no}
	</select>
	
	<select id="selectReviewCount" parameterType="int" resultType="_int">
		select count(reply_no) from review where room_no = #{ room_no }
	</select> 
	
	<insert id="insertRoom" parameterType="Room">
		insert into room values((select max(room_no) from room) + 1, #{user_id}, #{room_name }, #{room_content }, #{room_address }, #{room_roadaddress}, #{st_num_people }, #{ max_people},
		 #{ checkin_time}, #{checkout_time }, #{ bed}, #{bedroom }, #{bathroom },
		 <if test="amenity == null">
		 	null,
		 </if>
		 <if test="amenity != null">
		 	#{ amenity},
		 </if>
		 
		 <if test="facility == null">
		 	null,
		 </if>
		 <if test="facility != null">
		 	#{ facility}, 
		 </if>
		 
		 <if test="build_type == null">
		 	null,
		 </if>
		 <if test="build_type != null">
		 	#{build_type },
		 </if>
		 
		 <if test="rule == null">
		 	null,
		 </if>
		 <if test="rule != null">
		 	#{rule },
		 </if>
			default,  #{plus_charge }, 
		<if test="room_thumbnail_file == null">
			null, null)
		</if>
		<if test="room_thumbnail_file != null">
			#{room_thumbnail_file }, #{room_rename_file })
		</if>
		
	</insert>
	
	<update id="updateRoom" parameterType="Room">
		update room set room_name = #{room_name}, room_content = #{room_content}, room_address=#{room_address}, room_roadaddress=#{room_roadaddress},st_num_people = #{ st_num_people }, 
		max_people = #{ max_people }, checkin_time = #{checkin_time}, checkout_time= #{checkout_time}, bed = #{ bed}, bedroom=#{bedroom}, bathroom = #{bathroom},
		amenity = # { amenity }, facility = # { facility }, build_type = #{ build_type }, rule = #{ rule }, plus_chaarge = #{plus_chaarge}, room_thumbnail_file = #{room_thumbnail_file },room_rename_file= #{room_rename_file }
	</update>
	
	<update id="updateAvg" parameterType="int">
		update room set score_avg = #{score_avg}
	</update>
	
	<delete id="deleteRoom" parameterType="int">
		delete from room where room_no = #{ room_no }
	</delete>
	
	<delete id="deleteRoomFile" parameterType="int">
		delete from room_file where room_no = #{ room_no}
	</delete>
	
	<delete id="deleteRoomRivew" parameterType="int">
		delete from review where room_no = #{ room_no}
	</delete>
</mapper>
